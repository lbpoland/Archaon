<html><head><title>File scripting.c
</title></head><body bgcolor="#ffffff" TEXT="#000030" LINK="#4a529c" VLINK="#b57339">[ <a href="index.html">Package Index</a></code> | <a href="index_std.html">Mudlib Index</a></code> | <a href="index_eff.html">Effect Index</a></code> ]<br><h2>File /std/room/inherit/scripting.c</h2>
This is the standard inheritable to enable players to script npcs.
<p>
All you need to do is inherit this file, make sure you call the ::init,
and make sure you have a few functions defined in your context.
<p>
If you are not using a player shop inherit then you must ensure that
is_allowed( name ) returns 1 if the player is allowed to edit scripts
in this object.
<p>
You will need to write your own find_npc() function, since this is
extremely sensitive to the implementation.  For reference check out
the one which will be written for player controlled shops.
<p>
It is assumed that a save object will be inherited, if not
then event_save() will need to be defined.

<p><b>See also:</b><br><a href="#trigger_thingy">trigger_thingy(), return_script()
</a><p>Written by Nofear
<h3>Example</h3>
<pre>inherit "/std/room/scripting";
inherit "/std/room";

void init(){
   scripting::init();
   ..
}

void setup(){
   ..
   add_help_file( DOCS +"scripting" );
}</pre>
<hr><h2>Inherits</h2>
This class inherits the following classes <a href="std.basic.expressions.c.html">/std/basic/expressions.c</a><hr><h2>Includes</h2>
This class includes the following files <a href="include.nroff.h.html">/include/nroff.h</a> and <a href="include.expressions.h.html">/include/expressions.h</a><hr><h2>Class Index</h2>
<dl><dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class_running_script"><b>running_script</b></a>
<dd>
This class contains each element of the script itself.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class_script"><b>script</b></a>
<dd>
This class contains each element of the script itself.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class_script_data"><b>script_data</b></a>
<dd>
This class contains each element of the script itself.
</dl><hr><h2>Method index</h2>
<dl><dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#delete_script_data_location"><b>delete_script_data_location</b></a>(string, int)<dd>
This method deletes the script data at the specified location.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#insert_script_data_before"><b>insert_script_data_before</b></a>(string, int, class script_data)<dd>
This method inserts a data element before the specified position in the
script.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_script"><b>query_script</b></a>(string)<dd>
This returns the script associated with the event.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_script_string"><b>query_script_string</b></a>(class scripting *)<dd>
This returns a printable string of the script.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#repeat_loop"><b>repeat_loop</b></a>()<dd>
This function is called by trigger_thingy and by itself.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_script"><b>set_script</b></a>(string, class scripting *)<dd>
This sets the specific script to the new value.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_script_actors"><b>set_script_actors</b></a>(string, string *)<dd>
This method sets the actors associated with the script.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_script_data"><b>set_script_data</b></a>(string, class script_data *)<dd>
This method sets the script data.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_script_data_location"><b>set_script_data_location</b></a>(string, int, class script_data)<dd>
This method replaces the script data at the specified location in
the script with a new item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#trigger_script"><b>trigger_script</b></a>(string, object, int)<dd>
This function is called to activate a script in this object.
</dl><hr><h2>Public Functions</h2>
These are functions that everyone can access.<p><dl>
.<dt><a name="delete_script_data_location">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>delete_script_data_location</b></a><pre>
int delete_script_data_location(string name,
int pos)
</pre><dd>
This method deletes the script data at the specified location.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the script name
<dd>pos - the position to replace
<dt><b>Returns:</b>
<dd>1 on success, 0 on failure

</dl>

<dt><a name="insert_script_data_before">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>insert_script_data_before</b></a><pre>
int insert_script_data_before(string name,
int pos,
class script_data data)
</pre><dd>
This method inserts a data element before the specified position in the
script.  If the position is 0 then the element is inserted at the start,
if the position is beyond the end of the array, then the item is inserter
at the end.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the script name
<dd>pos - the position to insert before
<dd>data - the data to replace it with

</dl>

<dt><a name="query_script">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_script</b></a><pre>
class script query_script(string name)
</pre><dd>
This returns the script associated with the event.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - The name of the script.
</dl>

<dt><a name="query_script_string">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_script_string</b></a><pre>
string query_script_string(class scripting * script)
</pre><dd>
This returns a printable string of the script.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd> - script the script to turn into a string
<dt><b>Returns:</b>
<dd>the string version of the script

</dl>

<dt><a name="repeat_loop">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>repeat_loop</b></a><pre>
void repeat_loop()
</pre><dd>
This function is called by trigger_thingy and by itself.
<p>
You could mask this if you need to restrict what the npcs are allowed
to say.
<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>this_script - the script contents,
<dd>num - the line number we are up to
<dd>who - the person we are looking at

</dl>

<dt><a name="set_script">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_script</b></a><pre>
void set_script(string name,
class scripting * script)
</pre><dd>
This sets the specific script to the new value.
<p>

<dt><a name="set_script_actors">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_script_actors</b></a><pre>
void set_script_actors(string name,
string * actors)
</pre><dd>
This method sets the actors associated with the script.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the name of the event to set the data for
<dd>actors - the actors for the script

</dl>

<dt><a name="set_script_data">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_script_data</b></a><pre>
void set_script_data(string name,
class script_data * data)
</pre><dd>
This method sets the script data.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the event to set the data for
<dd>data - the script data

</dl>

<dt><a name="set_script_data_location">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_script_data_location</b></a><pre>
int set_script_data_location(string name,
int pos,
class script_data data)
</pre><dd>
This method replaces the script data at the specified location in
the script with a new item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the script name
<dd>pos - the position to replace
<dd>data - the data to replace it with
<dt><b>Returns:</b>
<dd>1 on success, 0 on failure

</dl>

<dt><a name="trigger_script">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>trigger_script</b></a><pre>
void trigger_script(string event,
object who,
int override)
</pre><dd>
This function is called to activate a script in this object.
( Can be left blank, best to use file_name( this_player() ) ).<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>event - the name of the event to be triggered,
<dd>who - a reference to the object who triggered the event
<dd>override - the override for the priority

</dl>

</dl>
<hr><h2>Classes</h2>
These are nice data types for dealing with...  Data!<p>
<dl>
<dt><a name="class_running_script">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>running_script</b></a><pre>
class running_script {
class script script;
int position;
object who;
string who_name;
string who_short;
int run_priority;
}

</pre><dd>
This class contains each element of the script itself.<p>

<dt><a name="class_script">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>script</b></a><pre>
class script {
string * valid_actors;
class script_data * data;
int priority;
}

</pre><dd>
This class contains each element of the script itself.<p>

<dt><a name="class_script_data">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>script_data</b></a><pre>
class script_data {
int type;
string actor;
string str;
class parse_node * expr;
int number;
}

</pre><dd>
This class contains each element of the script itself.<p>

</dl>
<hr>
<center><font size="-1"><a href="http://discworld.imaginary.com/login.html">Discworld MUD</a>'s distribution world wide web pages.<br>brought to you by<br><strong>Cut Me Own Throat Dibbler's <a href="http://discworld.imaginary.com/sausages.html">Sensational Sausages</a>;&nbsp;buy one while they are hot.</strong><br>File last modified: Tue, 27 Mar 2018 06:44:49 GMT<br>
<hr>Lost?  Try Discworld's <a href="http://discworld.imaginary.com/">home page</a>.</center></body></html>