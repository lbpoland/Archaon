<html><head><title>File auction_house.c
</title></head><body bgcolor="#ffffff" TEXT="#000030" LINK="#4a529c" VLINK="#b57339">[ <a href="index.html">Package Index</a></code> | <a href="index_std.html">Mudlib Index</a></code> | <a href="index_eff.html">Effect Index</a></code> ]<br><h2>File /std/shops/inherit/auction_house.c</h2>
This inherit handles auctioning stuff.<p>Written by Pinkfish<p>Started Mon Apr 30 22:47:38 PDT 2001
<hr><h2>Inherits</h2>
This class inherits the following classes <a href="std.shops.inherit.open_shop.c.html">/std/shops/inherit/open_shop.c</a> and <a href="std.shops.inherit.shop_event.c.html">/std/shops/inherit/shop_event.c</a><hr><h2>Includes</h2>
This class includes the following files <a href="include.room.auction.h.html">/include/room/auction.h</a>, <a href="include.mail.h.html">/include/mail.h</a>, <a href="include.player_handler.h.html">/include/player_handler.h</a>, <a href="include.move_failures.h.html">/include/move_failures.h</a>, <a href="include.player.h.html">/include/player.h</a>, <a href="include.am_time.h.html">/include/am_time.h</a>, <a href="include.shops.bank.h.html">/include/shops/bank.h</a>, <a href="include.money.h.html">/include/money.h</a> and <a href="include.playtesters.h.html">/include/playtesters.h</a><hr><h2>Class Index</h2>
<dl><dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class_auction"><b>auction</b></a>
</dl><hr><h2>Method index</h2>
<dl><dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#add_item_to_auction"><b>add_item_to_auction</b></a>(object *, string, int, string, int, string, mixed)<dd>
This method puts an item up for auction.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#bid_on_item"><b>bid_on_item</b></a>(class auction, int, string)<dd>
This method makes a bid on an item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#confirm_auction"><b>confirm_auction</b></a>(string, string, object *, int, int)<dd>Confirm the addition 
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_add"><b>do_add</b></a>(string, object *, string, string)<dd>
This method adds an item for bidding.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_bid"><b>do_bid</b></a>(string, string)<dd>
This method makes a bid on the specified item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_browse"><b>do_browse</b></a>(string)<dd>
This method allows you to browse the item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_claim"><b>do_claim</b></a>()<dd>
This method claims anything that you can bought and is waiting for
pickup.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_info"><b>do_info</b></a>()<dd>
This method shoes information about the auction house, like the
amount of time for each type of auction.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_list"><b>do_list</b></a>()<dd>
This method lists all the current auctions.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_withdraw"><b>do_withdraw</b></a>(string)<dd>
This method withdraws the item from bidding.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#finish_auction"><b>finish_auction</b></a>(class auction)<dd>
This method finishes the aution on the specified item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#force_finish_auction"><b>force_finish_auction</b></a>(string)<dd>
This method forcibly finishes the auction on the specified item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#load_me"><b>load_me</b></a>()<dd>
This method loads the auction house up.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#next_auction_finish"><b>next_auction_finish</b></a>()<dd>
This method figures out when the next auction finishes and sets up
a timeout.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_auction_end_string"><b>query_auction_end_string</b></a>(class auction)<dd>
This method printsd a nice string showing how long till the auction
ends.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_auction_item"><b>query_auction_item</b></a>(string)<dd>
This method finds the item based on some useful string.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_auction_objects"><b>query_auction_objects</b></a>(class auction)<dd>
This method finds the objects associated with the auction item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_auction_times"><b>query_auction_times</b></a>()<dd>
This method returns the length of auctions in seconds.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_auctions"><b>query_auctions</b></a>()<dd>
This method returns the current list of available auctions.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_finished_auctions"><b>query_finished_auctions</b></a>()<dd>
This method returns the current list of finished auctions.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_last_auction_finish_time"><b>query_last_auction_finish_time</b></a>()<dd>
This method figures out when the last auction will finish.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_save_file"><b>query_save_file</b></a>()<dd>
This method queries the save file name.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_time_end_string"><b>query_time_end_string</b></a>(int)<dd>
This method prints a nice string showing how long it is till then
end of the thing.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#remove_auction_item"><b>remove_auction_item</b></a>(class auction)<dd>
This method removes the specified auction from the list.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#remove_finished_auction_item"><b>remove_finished_auction_item</b></a>(class auction)<dd>
This method removes the specified auction from the list.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#retry_auction"><b>retry_auction</b></a>(class auction)<dd>
This method retries the aution on the specified item.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#save_me"><b>save_me</b></a>()<dd>
This method saves the auction house.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_allowed_add"><b>set_allowed_add</b></a>(int)<dd>
This method sets the allowed add flag.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_auction_time"><b>set_auction_time</b></a>(string, int)<dd>
This method sets the length of auctions in seconds.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_check_can_bid"><b>set_check_can_bid</b></a>(function)<dd>
This method sets a function to be called to check if someone can
bid or not.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_max_auctions"><b>set_max_auctions</b></a>(int)<dd>
This method sets the maximum number of simultaneous auctions.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_max_retries"><b>set_max_retries</b></a>(int)<dd>
This method sets the number of times an item will be retried before
the auction is failed.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_min_bid_increase"><b>set_min_bid_increase</b></a>(int)<dd>
This method sets the minimum bid increase (as a percentage of the
current bid).
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_retrieval_time"><b>set_retrieval_time</b></a>(int)<dd>
This method sets the length of the retrieval time.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_save_file"><b>set_save_file</b></a>(string)<dd>
This method sets the save file name.
</dl><hr><h2>Public Functions</h2>
These are functions that everyone can access.<p><dl>
.<dt><a name="add_item_to_auction">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>add_item_to_auction</b></a><pre>
int add_item_to_auction(object * obs,
string name,
int reserve,
string seller,
int length,
string end_function,
mixed extra)
</pre><dd>
This method puts an item up for auction.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>obs - the objects to sell
<dd>name - the name of the item
<dd>reserve - the reserve price of the item
<dd>seller - the seller of the item
<dd>length - the length of the auction
<dd>end_function - the function to call when the item is sold
<dt><b>Returns:</b>
<dd>1 on success, 0 on failure

</dl>

<dt><a name="bid_on_item">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>bid_on_item</b></a><pre>
void bid_on_item(class auction auct,
int bid,
string person)
</pre><dd>
This method makes a bid on an item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>item - the item to bid on
<dd>bid - the amount to bid
<dd>person - the person making the bid

</dl>

<dt><a name="confirm_auction">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>confirm_auction</b></a><pre>
void confirm_auction(string check,
string name,
object * obs,
int reserve,
int len)
</pre><dd>Confirm the addition <p>

<dt><a name="do_add">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_add</b></a><pre>
int do_add(string name,
object * obs,
string res_str,
string length)
</pre><dd>
This method adds an item for bidding.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the name to put them up for bidding as
<dd>obs - the objects to auction
<dd>res_str - the reserve price
<dd>length - the length of the auction
<dt><b>Returns:</b>
<dd>1 on success, 0 on failed

</dl>

<dt><a name="do_bid">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_bid</b></a><pre>
int do_bid(string id,
string bid)
</pre><dd>
This method makes a bid on the specified item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>id - the item to bid on
<dd>bid - the amount to bid
<dt><b>Returns:</b>
<dd>1 on success, 0 on failure

</dl>

<dt><a name="do_browse">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_browse</b></a><pre>
int do_browse(string id)
</pre><dd>
This method allows you to browse the item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>id - the id of the auction thing to browse

</dl>

<dt><a name="do_claim">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_claim</b></a><pre>
int do_claim()
</pre><dd>
This method claims anything that you can bought and is waiting for
pickup.
<p>

<dt><a name="do_info">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_info</b></a><pre>
int do_info()
</pre><dd>
This method shoes information about the auction house, like the
amount of time for each type of auction.<p>
<dd><dl>
<dt><b>Returns:</b>
<dd>1 on success

</dl>

<dt><a name="do_list">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_list</b></a><pre>
int do_list()
</pre><dd>
This method lists all the current auctions.
<p>

<dt><a name="do_withdraw">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_withdraw</b></a><pre>
int do_withdraw(string id)
</pre><dd>
This method withdraws the item from bidding.  You pay a penalty when you
do this, 10% of the current item cost.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>id - the id to withdraw

</dl>

<dt><a name="finish_auction">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>finish_auction</b></a><pre>
void finish_auction(class auction auction)
</pre><dd>
This method finishes the aution on the specified item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction item that is being finished

</dl>

<dt><a name="force_finish_auction">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>force_finish_auction</b></a><pre>
void force_finish_auction(string id)
</pre><dd>
This method forcibly finishes the auction on the specified item.
This is only to be used for debugging purposes.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction item that is being finished

</dl>

<dt><a name="load_me">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>load_me</b></a><pre>
void load_me()
</pre><dd>
This method loads the auction house up.
<p>

<dt><a name="next_auction_finish">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>next_auction_finish</b></a><pre>
void next_auction_finish()
</pre><dd>
This method figures out when the next auction finishes and sets up
a timeout.
<p>

<dt><a name="query_auction_end_string">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_auction_end_string</b></a><pre>
string query_auction_end_string(class auction auction)
</pre><dd>
This method printsd a nice string showing how long till the auction
ends.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction to get an end string for
<dt><b>Returns:</b>
<dd>auction end string

</dl>

<dt><a name="query_auction_item">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_auction_item</b></a><pre>
class auction query_auction_item(string id)
</pre><dd>
This method finds the item based on some useful string.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>id - the id to lookup
<dt><b>Returns:</b>
<dd>the auction item, 0 in the case of error

</dl>

<dt><a name="query_auction_objects">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_auction_objects</b></a><pre>
object * query_auction_objects(class auction auct)
</pre><dd>
This method finds the objects associated with the auction item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction item
<dt><b>Returns:</b>
<dd>the objects associated with it

</dl>

<dt><a name="query_auction_times">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_auction_times</b></a><pre>
mapping query_auction_times()
</pre><dd>
This method returns the length of auctions in seconds.<p>
<dd><dl>
<dt><b>Returns:</b>
<dd>the length of auctions.

</dl>

<dt><a name="query_auctions">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_auctions</b></a><pre>
class auction * query_auctions()
</pre><dd>
This method returns the current list of available auctions.<p>
<dd><dl>
<dt><b>Returns:</b>
<dd>the current auctions

</dl>

<dt><a name="query_finished_auctions">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_finished_auctions</b></a><pre>
class auction * query_finished_auctions()
</pre><dd>
This method returns the current list of finished auctions.<p>
<dd><dl>
<dt><b>Returns:</b>
<dd>the current auctions

</dl>

<dt><a name="query_last_auction_finish_time">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_last_auction_finish_time</b></a><pre>
int query_last_auction_finish_time()
</pre><dd>
This method figures out when the last auction will finish.<p>
<dd><dl>
<dt><b>Returns:</b>
<dd>when the last auction finished

</dl>

<dt><a name="query_save_file">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_save_file</b></a><pre>
string query_save_file()
</pre><dd>
This method queries the save file name.
<p>

<dt><a name="query_time_end_string">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_time_end_string</b></a><pre>
string query_time_end_string(int left)
</pre><dd>
This method prints a nice string showing how long it is till then
end of the thing.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>left - the time to get the difference for
<dt><b>Returns:</b>
<dd>time end string

</dl>

<dt><a name="remove_auction_item">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>remove_auction_item</b></a><pre>
void remove_auction_item(class auction auction)
</pre><dd>
This method removes the specified auction from the list.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction item that is being removed

</dl>

<dt><a name="remove_finished_auction_item">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>remove_finished_auction_item</b></a><pre>
void remove_finished_auction_item(class auction auction)
</pre><dd>
This method removes the specified auction from the list.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction item that is being removed

</dl>

<dt><a name="retry_auction">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>retry_auction</b></a><pre>
void retry_auction(class auction auction)
</pre><dd>
This method retries the aution on the specified item.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>auction - the auction item that is being finished

</dl>

<dt><a name="save_me">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>save_me</b></a><pre>
void save_me()
</pre><dd>
This method saves the auction house.
<p>

<dt><a name="set_allowed_add">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_allowed_add</b></a><pre>
void set_allowed_add(int flag)
</pre><dd>
This method sets the allowed add flag.  If theis flag is set to 0
then it is not possible for players to add items for
auctions.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>flag - the allowed add flag

</dl>

<dt><a name="set_auction_time">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_auction_time</b></a><pre>
void set_auction_time(string index,
int i)
</pre><dd>
This method sets the length of auctions in seconds.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>index - the name of the auction type to change
<dd>i - the length of auctions.

</dl>

<dt><a name="set_check_can_bid">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_check_can_bid</b></a><pre>
void set_check_can_bid(function f)
</pre><dd>
This method sets a function to be called to check if someone can
bid or not.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>func - the function to call

</dl>

<dt><a name="set_max_auctions">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_max_auctions</b></a><pre>
void set_max_auctions(int i)
</pre><dd>
This method sets the maximum number of simultaneous auctions.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>i - the number of items.

</dl>

<dt><a name="set_max_retries">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_max_retries</b></a><pre>
void set_max_retries(int i)
</pre><dd>
This method sets the number of times an item will be retried before
the auction is failed.
<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>i - the number of seconds the item will wait for someone to claim it.

</dl>

<dt><a name="set_min_bid_increase">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_min_bid_increase</b></a><pre>
void set_min_bid_increase(int i)
</pre><dd>
This method sets the minimum bid increase (as a percentage of the
current bid).
<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>i - percentage

</dl>

<dt><a name="set_retrieval_time">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_retrieval_time</b></a><pre>
void set_retrieval_time(int i)
</pre><dd>
This method sets the length of the retrieval time.
<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>i - the number of seconds the item will wait for someone to claim it.

</dl>

<dt><a name="set_save_file">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_save_file</b></a><pre>
void set_save_file(string fname)
</pre><dd>
This method sets the save file name.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>fname - the save file name

</dl>

</dl>
<hr><h2>Classes</h2>
These are nice data types for dealing with...  Data!<p>
<dl>
<dt><a name="class_auction">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>auction</b></a><pre>
class auction {
mixed save_stuff;
int time_started;
int auction_length;
string name;
string seller;
string current_bidder;
int bid;
int reserve;
int retries;
string end_function;
mixed extra;
}

</pre>
</dl>
<hr>
<center><font size="-1"><a href="http://discworld.imaginary.com/login.html">Discworld MUD</a>'s distribution world wide web pages.<br>brought to you by<br><strong>Cut Me Own Throat Dibbler's <a href="http://discworld.imaginary.com/sausages.html">Sensational Sausages</a>;&nbsp;buy one while they are hot.</strong><br>File last modified: Tue, 27 Mar 2018 02:22:19 GMT<br>
<hr>Lost?  Try Discworld's <a href="http://discworld.imaginary.com/">home page</a>.</center></body></html>