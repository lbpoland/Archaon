<html><head><title>File p_library.c
</title></head><body bgcolor="#ffffff" TEXT="#000030" LINK="#4a529c" VLINK="#b57339">[ <a href="index.html">Package Index</a></code> | <a href="index_std.html">Mudlib Index</a></code> | <a href="index_eff.html">Effect Index</a></code> ]<br><h2>File /std/room/inherit/p_library.c</h2>
Library inherit. Allows players to take out books on loan. If
set to be player contributable, then books (most likely player 
written, but any kind) can be added/removed by designated 
librarian players.
<p>Written by Aquilo
<hr><h2>Inherits</h2>
This class inherits the following classes <a href="std.room.basic_room.c.html">/std/room/basic_room.c</a><hr><h2>Includes</h2>
This class includes the following files <a href="include.player_handler.h.html">/include/player_handler.h</a>, <a href="include.player.h.html">/include/player.h</a>, <a href="include.am_time.h.html">/include/am_time.h</a>, <a href="include.language.h.html">/include/language.h</a>, <a href="include.shops.bank.h.html">/include/shops/bank.h</a>, <a href="include.playtesters.h.html">/include/playtesters.h</a>, <a href="include.money.h.html">/include/money.h</a> and <a href="include.book_handler.h.html">/include/book_handler.h</a><hr><h2>Class Index</h2>
<dl><dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class__account"><b>_account</b></a>
<dd>
Holds info on a player.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class__book"><b>_book</b></a>
<dd>
This is all the info on one of our stored books.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#class__loan"><b>_loan</b></a>
<dd>
This holds info on a book a player has borrowed
</dl><hr><h2>Method index</h2>
<dl><dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#add_book_to_library"><b>add_book_to_library</b></a>(mixed, int, string, string, int)<dd>
This function adds the specified object to the library 
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#clear_loan"><b>clear_loan</b></a>(mixed, int, int)<dd>
This clears the loan of library book id the specified player.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_lost_damaged_fine"><b>do_lost_damaged_fine</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_mark"><b>do_mark</b></a>(int, int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_report"><b>do_report</b></a>(int, string, string)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_set_fine"><b>do_set_fine</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#do_set_loan_length"><b>do_set_loan_length</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_access"><b>query_access</b></a>(mixed)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_borrow_func"><b>query_borrow_func</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_borrowed_by"><b>query_borrowed_by</b></a>(int)<dd>
Returns a mapping of players who borrowed the given book id, mapped to their 
due back dates.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_fine"><b>query_fine</b></a>(string)<dd>
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_fine_per_day"><b>query_fine_per_day</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_library_name"><b>query_library_name</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_loan_length"><b>query_loan_length</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_loans"><b>query_loans</b></a>(string)<dd>
Returns a mapping of book ids to due back dates for the given player.
<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_lost_damaged_fine"><b>query_lost_damaged_fine</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_max_loans"><b>query_max_loans</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_player_contributable"><b>query_player_contributable</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#query_save_file"><b>query_save_file</b></a>()<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_access"><b>set_access</b></a>(string, int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_borrow_func"><b>set_borrow_func</b></a>(function)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_fine_per_day"><b>set_fine_per_day</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_library_name"><b>set_library_name</b></a>(string)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_loan_length"><b>set_loan_length</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_lost_damaged_fine"><b>set_lost_damaged_fine</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_max_loans"><b>set_max_loans</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_player_contributable"><b>set_player_contributable</b></a>(int)<dt><img src="images/cyan-ball-small.gif" height=6 width=6 alt=" o ">
<a href="#set_save_file"><b>set_save_file</b></a>(string)</dl><hr><h2>Public Functions</h2>
These are functions that everyone can access.<p><dl>
.<dt><a name="add_book_to_library">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>add_book_to_library</b></a><pre>
varargs int add_book_to_library(mixed thing,
int copies,
string cap_title,
string cap_author,
int borrowable)
</pre><dd>
This function adds the specified object to the library <p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>thing - Either a filename, or object. If its an object we record its autoload info
<dd>copies - how many copies to add
<dd>cap_title - The capitalized title its cataloged under
<dd>cap_author - The capitalized author of the work
<dd>borrowable - 1 if it can be borrowed, 0 if its reference only

</dl>

<dt><a name="clear_loan">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>clear_loan</b></a><pre>
void clear_loan(mixed player,
int id,
int calc_fines)
</pre><dd>
This clears the loan of library book id the specified player.
If its overdue it sorts out adding a fine to his name.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>player - Either the player name or object
<dd>id - the library book id
<dd>calc_fines - if this is 1, then we add fines onto the player
if appropriate, if 0 then we ignore fines and just clear the loan

</dl>

<dt><a name="do_lost_damaged_fine">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_lost_damaged_fine</b></a><pre>
int do_lost_damaged_fine(int i)
</pre>
<dt><a name="do_mark">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_mark</b></a><pre>
int do_mark(int id,
int flag)
</pre>
<dt><a name="do_report">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_report</b></a><pre>
int do_report(int id,
string arg,
string player)
</pre>
<dt><a name="do_set_fine">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_set_fine</b></a><pre>
int do_set_fine(int i)
</pre>
<dt><a name="do_set_loan_length">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>do_set_loan_length</b></a><pre>
int do_set_loan_length(int days)
</pre>
<dt><a name="query_access">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_access</b></a><pre>
int query_access(mixed player)
</pre>
<dt><a name="query_borrow_func">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_borrow_func</b></a><pre>
function query_borrow_func()
</pre>
<dt><a name="query_borrowed_by">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_borrowed_by</b></a><pre>
mapping query_borrowed_by(int id)
</pre><dd>
Returns a mapping of players who borrowed the given book id, mapped to their 
due back dates.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>id - valid book id

</dl>

<dt><a name="query_fine">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_fine</b></a><pre>
int query_fine(string name)
</pre><dd><p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the string name of the person to check
<dt><b>Returns:</b>
<dd>How much of a fine this person has

</dl>

<dt><a name="query_fine_per_day">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_fine_per_day</b></a><pre>
int query_fine_per_day()
</pre>
<dt><a name="query_library_name">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_library_name</b></a><pre>
string query_library_name()
</pre>
<dt><a name="query_loan_length">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_loan_length</b></a><pre>
int query_loan_length()
</pre>
<dt><a name="query_loans">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_loans</b></a><pre>
mapping query_loans(string name)
</pre><dd>
Returns a mapping of book ids to due back dates for the given player.<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd>name - the player
<dt><b>Returns:</b>
<dd>a mapping in the form ([ book id : due back ])

</dl>

<dt><a name="query_lost_damaged_fine">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_lost_damaged_fine</b></a><pre>
int query_lost_damaged_fine()
</pre>
<dt><a name="query_max_loans">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_max_loans</b></a><pre>
int query_max_loans()
</pre>
<dt><a name="query_player_contributable">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_player_contributable</b></a><pre>
int query_player_contributable()
</pre>
<dt><a name="query_save_file">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>query_save_file</b></a><pre>
string query_save_file()
</pre>
<dt><a name="set_access">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_access</b></a><pre>
void set_access(string player,
int access)
</pre>
<dt><a name="set_borrow_func">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_borrow_func</b></a><pre>
void set_borrow_func(function f)
</pre>
<dt><a name="set_fine_per_day">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_fine_per_day</b></a><pre>
void set_fine_per_day(int i)
</pre>
<dt><a name="set_library_name">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_library_name</b></a><pre>
void set_library_name(string str)
</pre>
<dt><a name="set_loan_length">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_loan_length</b></a><pre>
void set_loan_length(int i)
</pre>
<dt><a name="set_lost_damaged_fine">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_lost_damaged_fine</b></a><pre>
void set_lost_damaged_fine(int i)
</pre>
<dt><a name="set_max_loans">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_max_loans</b></a><pre>
void set_max_loans(int i)
</pre>
<dt><a name="set_player_contributable">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_player_contributable</b></a><pre>
void set_player_contributable(int i)
</pre>
<dt><a name="set_save_file">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>set_save_file</b></a><pre>
void set_save_file(string s)
</pre>
</dl>
<hr><h2>Classes</h2>
These are nice data types for dealing with...  Data!<p>
<dl>
<dt><a name="class__account">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>_account</b></a><pre>
class _account {
int total_fines_paid;
int lost_damaged;
class _loan * loans;
}

</pre><dd>
Holds info on a player.<p>

<dt><a name="class__book">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>_book</b></a><pre>
class _book {
string path;
string auto_load;
string cap_title;
string cap_author;
mapping loaned;
int borrowable;
int copies;
int total_borrowed;
}

</pre><dd>
This is all the info on one of our stored books.<p>

<dt><a name="class__loan">
<img src="images/cyan-ball.gif" width=12 height=12 alt=" * "><b>_loan</b></a><pre>
class _loan {
int id;
int due_back;
}

</pre><dd>
This holds info on a book a player has borrowed<p>

</dl>
<hr>
<center><font size="-1"><a href="http://discworld.imaginary.com/login.html">Discworld MUD</a>'s distribution world wide web pages.<br>brought to you by<br><strong>Cut Me Own Throat Dibbler's <a href="http://discworld.imaginary.com/sausages.html">Sensational Sausages</a>;&nbsp;buy one while they are hot.</strong><br>File last modified: Tue, 27 Mar 2018 06:13:47 GMT<br>
<hr>Lost?  Try Discworld's <a href="http://discworld.imaginary.com/">home page</a>.</center></body></html>